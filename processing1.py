import pandas as pd
import os
import threading

csvBasePath = "./csv/"
pcapBasePath = "./data/"
outBasePath = "./singlePcap/"
baseNumber = 0
c = 0
def run(csvPath,pcapinPath,outTempPath):
    baseNumber = 0
    for file in os.listdir(csvPath):
        cp = csvPath+"/"+file
        pp = pcapinPath+"/"+os.path.splitext(file)[0]+".pcap"
        tls = pd.read_csv(cp)
        for index, row in tls.iterrows():
            outPath = outTempPath+"/out"+str(baseNumber)+".pcap"
            src=row['1']
            dst=row['2']
            srcport = row['3']
            dstport = row['4']
            cmdstr = "tshark -r "+str(pp)+" -Y \"(ip.src=="+str(src)+" and ip.dst=="+str(dst)+" and tcp.srcport == "+str(srcport)+" and tcp.dstport == "+str(dstport)+") or (ip.src=="+str(dst)+" and ip.dst=="+str(src)+" and tcp.srcport == "+str(dstport)+" and tcp.dstport == "+str(srcport)+")\" -w "+outPath
            os.system(cmdstr)
            baseNumber = baseNumber+1
            print(file+"完成")

for dir in os.listdir(csvBasePath):
    for lastDir in os.listdir(csvBasePath+dir):
        print(lastDir)
        # inCsvPath = os.path.join(csvBasePath + dir,lastDir)
        # pcapinPath = os.path.join(pcapBasePath +dir,lastDir)
        # outPath = os.path.join(outBasePath + dir,lastDir)
        # if not os.path.exists(outPath):
        #     os.makedirs(outPath)
        # t = threading.Thread(target=run, args=(inCsvPath,pcapinPath,outPath))
        # t.start()